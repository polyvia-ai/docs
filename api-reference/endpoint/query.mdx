---
title: "Query"
description: "Search and reason over your visual knowledge base"
---

The Query endpoint provides visual search and reasoning capabilities across your indexed documents. Get answers with audit-ready citations pointing to exact sources.

## Search Knowledge Base

Perform visual search and reasoning across your entire knowledge base.

### Endpoint

`POST /query`

### Request Body

<ParamField body="query" type="string" required>
  Natural language query
</ParamField>

<ParamField body="include_citations" type="boolean" default="true">
  Include source citations in the response
</ParamField>

<ParamField body="limit" type="integer" default="10">
  Maximum number of source chunks to consider (1-50)
</ParamField>

<ParamField body="filters" type="object">
  Filter results by document metadata

  <Expandable title="Filter options">
    <ParamField body="document_ids" type="array">
      Limit search to specific documents
    </ParamField>

    <ParamField body="tags" type="array">
      Filter by document tags
    </ParamField>

    <ParamField body="date_range" type="object">
      Filter by document upload date
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="mode" type="string" default="reasoning">
  Query mode: `search` (return matching chunks) or `reasoning` (synthesized answer)
</ParamField>

### Response

<ResponseField name="answer" type="string">
  Synthesized answer to the query (when mode is `reasoning`)
</ResponseField>

<ResponseField name="citations" type="array">
  Source citations for the answer

  <Expandable title="Citation object">
    <ResponseField name="document_id" type="string">
      Source document identifier
    </ResponseField>

    <ResponseField name="document_name" type="string">
      Source document name
    </ResponseField>

    <ResponseField name="page" type="integer">
      Page number in source document
    </ResponseField>

    <ResponseField name="content" type="string">
      Relevant content snippet
    </ResponseField>

    <ResponseField name="visual_type" type="string">
      Type of visual source: `chart`, `table`, `diagram`, `text`, `infographic`
    </ResponseField>

    <ResponseField name="confidence" type="number">
      Confidence score (0-1)
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="query_time_ms" type="integer">
  Query execution time in milliseconds
</ResponseField>

### Example

<CodeGroup>
```bash cURL
curl -X POST https://api.polyvia.ai/query \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "What is the difference between Apple and Microsoft Q4 2024 revenue?",
    "include_citations": true,
    "mode": "reasoning"
  }'
```

```python Python
import requests

response = requests.post(
    "https://api.polyvia.ai/query",
    headers={
        "Authorization": f"Bearer {api_key}",
        "Content-Type": "application/json"
    },
    json={
        "query": "What is the difference between Apple and Microsoft Q4 2024 revenue?",
        "include_citations": True,
        "mode": "reasoning"
    }
)

result = response.json()
print(result["answer"])
for citation in result["citations"]:
    print(f"  Source: {citation['document_name']}, page {citation['page']}")
```

```javascript Node.js
const response = await fetch("https://api.polyvia.ai/query", {
  method: "POST",
  headers: {
    Authorization: `Bearer ${apiKey}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    query: "What is the difference between Apple and Microsoft Q4 2024 revenue?",
    include_citations: true,
    mode: "reasoning",
  }),
});

const result = await response.json();
console.log(result.answer);
```
</CodeGroup>

<ResponseExample>
```json Success
{
  "answer": "Apple's Q4 2024 revenue was $119.58B while Microsoft's Q4 2024 revenue was $62.02B. The difference is $57.56B, with Apple generating approximately 93% more revenue than Microsoft in this quarter.",
  "citations": [
    {
      "document_id": "doc_apple_10k",
      "document_name": "Apple 10-K 2024",
      "page": 24,
      "content": "Total net revenue: $119,575 million",
      "visual_type": "table",
      "confidence": 0.97
    },
    {
      "document_id": "doc_msft_10k",
      "document_name": "Microsoft 10-K 2024",
      "page": 31,
      "content": "Revenue: $62,020 million",
      "visual_type": "chart",
      "confidence": 0.95
    }
  ],
  "query_time_ms": 342
}
```
</ResponseExample>

---

## Search Mode

For simple retrieval without synthesized answers, use `mode: "search"`.

### Example

```json
{
  "query": "revenue charts",
  "mode": "search",
  "limit": 5
}
```

### Response

```json
{
  "results": [
    {
      "document_id": "doc_abc123",
      "document_name": "Q4 Financial Report",
      "page": 12,
      "content": "Q4 Revenue by Region chart showing...",
      "visual_type": "chart",
      "score": 0.94
    }
  ],
  "query_time_ms": 127
}
```

---

## Filtering

### Filter by Documents

Query only specific documents:

```json
{
  "query": "What were the key findings?",
  "filters": {
    "document_ids": ["doc_abc123", "doc_def456"]
  }
}
```

### Filter by Tags

Query documents with specific tags:

```json
{
  "query": "quarterly revenue trends",
  "filters": {
    "tags": ["finance", "quarterly"]
  }
}
```

### Filter by Date

Query documents from a specific time period:

```json
{
  "query": "security incidents",
  "filters": {
    "date_range": {
      "start": "2024-01-01",
      "end": "2024-12-31"
    }
  }
}
```

---

## Cross-Document Reasoning

Polyvia automatically reasons across multiple documents to answer complex queries. For example:

**Query:** "Compare the revenue growth of Apple, Microsoft, and Google over the last 3 years"

Polyvia will:
1. Search for revenue data across all relevant documents
2. Extract facts from charts, tables, and text
3. Synthesize a comparative answer with citations from each source

<Tip>
For best results with cross-document queries, ensure your documents are properly tagged with metadata like company names, time periods, and document types.
</Tip>

---

## Visual Citation Types

Polyvia identifies the type of visual source for each citation:

| Type | Description |
|------|-------------|
| `chart` | Bar charts, line graphs, pie charts |
| `table` | Data tables, spreadsheet content |
| `diagram` | Flow charts, org charts, architecture diagrams |
| `infographic` | Complex visual compositions |
| `text` | Regular text content |

This helps you understand where each piece of information originated.
